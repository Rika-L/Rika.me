# 单例模式

> by Rika 2024/6/4



> **保证一个类仅有一个实例，并提供一个访问它的全局访问点**

## 实现思路

判断是否已经创建过一个实例对象

```js
class SingleDog {
    show() {
		console.log('我是一个单例对象')
    }
    static getInstance() {
        // 判断是否已经new过一个实例对象
        if (!SingleDog.instance) {
        	// 如果实力不存在则创建实例
            SingleDog.instance = new SingleDog()
        }
        // 如果已经存在实例,则直接返回
        return SingleDog.instance
    }
}
```

```js
const s1 = SingleDog.getInstance()
const s2 = SingleDog.getInstance()

// true
s1 === s2
```

也可以使用闭包,但是我看不懂

```js
SingleDog.getInstance = (function() {
    // 定义自由变量instance，模拟私有变量
    let instance = null
    return function() {
        // 判断自由变量是否为null
        if(!instance) {
            // 如果为null则new出唯一实例
            instance = new SingleDog()
        }
        return instance
    }
})()
```

## 面试题

### 1

>实现Storage，使得该对象为单例，基于 localStorage 进行封装。实现方法 setItem(key,value) 和 getItem(key)。

```js
class Storage {
    static getInstance() {
        if (!Storage.instance) {
            Storage.instance = new Storage();
        }
        return Storage.instance
    }

    setItem(key, value) {
        console.log('setItem' + key +  value);
    }

    getItem(key) {
        console.log('getItem' + key);
    }
}

const storage1 = Storage.getInstance()

const storage2 = Storage.getInstance()

storage1.setItem('name', '李雷')
// 李雷
storage1.getItem('name')
// 也是李雷
storage2.getItem('name')

console.log(storage1 === storage2);
```

可以运行但不知道为什么WebStorm会报错

```cmd
未使用的 方法 setItem
未解析的函数或方法 setItem()
```

### 2

> 实现一个全局唯一的Modal弹框

待优化

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>dam</title>
</head>
<body>
<button id="open">打开</button>
<button id="close">关闭</button>
</body>
<script>
    class Model{
        static getInstance() {
            if (!Model.instance) {
                const model = document.createElement('div')
                model.id = 'model'
                model.innerText = 'hahaha'
                model.style.display = 'none'
                document.body.appendChild(model)
                Model.instance = new Model();
            }
            return Model.instance
        }
        openModel(){
            document.getElementById('model').style.display = 'block'
        }
        closeModel(){
            document.getElementById('model').style.display = 'none'
        }
    }
document.getElementById('open').addEventListener('click',()=>{
    const model = Model.getInstance()
    model.openModel()
})
document.getElementById('close').addEventListener('click',()=>{
    const model = Model.getInstance()
    model.closeModel()
})
</script>
</html>

```

优化思路：在实例化时传入dom
